<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASTA AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&amp;display=swap">
    <style>
        body { font-family: 'Inter', sans-serif; overflow: hidden; }
        #background-canvas { position: fixed; top:0; left:0; width:100%; height:100%; z-index:-1; }
        .chat-container { z-index:1; position: relative; }
        .message-box { display:none; position: fixed; top:50%; left:50%; transform:translate(-50%,-50%); background-color:#1e293b; padding:24px; border-radius:12px; box-shadow:0 4px 6px rgba(0,0,0,0.1); color:#e2e8f0; text-align:center; z-index:100; }
        .message-box button { margin-top:16px; }
        .scrollbar-hidden::-webkit-scrollbar { width: 0.5em; }
        .scrollbar-hidden::-webkit-scrollbar-thumb { background-color: transparent; }
        .code-box { background:#0f172a; color:#cbd5e1; padding:12px; border-radius:8px; font-family:monospace; white-space:pre-wrap; word-wrap:break-word; position:relative; margin-bottom:8px; max-width:80%; }
        .copy-btn { position:absolute; top:8px; left:8px; background:#3b82f6; color:white; padding:2px 6px; border-radius:4px; cursor:pointer; font-size:12px; }
        .popup-html { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); display:flex; align-items:center; justify-content:center; z-index:200; }
        .popup-content { background:white; width:90%; height:80%; border-radius:8px; overflow:auto; position:relative; }
        .popup-content iframe { width:100%; height:100%; border:none; border-radius:8px; }
        .popup-content button { position:absolute; top:8px; right:8px; background:red; color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer; }
        #copy-toast { position:fixed; top:16px; right:16px; background:#3b82f6; color:white; padding:8px 12px; border-radius:6px; display:none; z-index:300; font-size:14px; }
        
        /* تصميم جديد للهيدر */
        .header-chatgpt {
            background: linear-gradient(90deg, #0f172a 0%, #1e293b 100%);
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding: 12px 16px;
        }
        
        /* تصميم رسائل مثل ChatGPT */
        .user-message {
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            color: white;
            padding: 12px 16px;
            border-radius: 18px 18px 4px 18px;
            max-width: 85%;
            margin-left: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .ai-message {
            background: #f1f5f9;
            color: #334155;
            padding: 12px 16px;
            border-radius: 18px 18px 18px 4px;
            max-width: 85%;
            margin-right: auto;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        /* تصميم حقل الإدخال */
        .input-container {
            background: #f8fafc;
            border-radius: 24px;
            border: 1px solid #e2e8f0;
            padding: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
        }
        
        .input-container textarea {
            background: transparent;
            border: none;
            box-shadow: none;
        }
        
        .input-container textarea:focus {
            outline: none;
            box-shadow: none;
        }
        
        .send-button {
            background: #3b82f6;
            color: white;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .send-button:hover {
            background: #2563eb;
            transform: scale(1.05);
        }
        
        .send-button:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }
        
        /* تصميم رسائل التحميل */
        .typing-indicator {
            display: flex;
            padding: 12px 16px;
            background: #f1f5f9;
            border-radius: 18px;
            max-width: 85px;
        }
        
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #94a3b8;
            border-radius: 50%;
            margin: 0 3px;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) { animation-delay: 0s; }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }
    </style>
</head>
<body class="bg-slate-50">

<canvas id="background-canvas" width="400" height="724"></canvas>

<div class="chat-container flex flex-col h-screen">

<header class="header-chatgpt flex items-center justify-between">
    <div class="flex items-center space-x-2">
        <div class="w-8 h-8 bg-indigo-600 rounded-lg flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor">
                <path d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
            </svg>
        </div>
        <h1 class="text-lg font-semibold text-slate-800">ASTA AI</h1>
    </div>
    <div class="flex items-center space-x-4">
        <button id="newChatBtn" class="text-sm text-slate-600 hover:text-slate-800 font-medium transition-colors duration-200">
            محادثة جديدة
        </button>
        <div class="w-8 h-8 bg-gradient-to-r from-indigo-500 to-purple-500 rounded-full"></div>
    </div>
</header>

<main id="chat-window" class="flex-grow p-4 overflow-y-auto scrollbar-hidden space-y-4 pb-20">
    <div class="flex justify-start">
        <div class="ai-message">
            مرحباً! كيف يمكنني مساعدتك اليوم؟
        </div>
    </div>
</main>

<footer class="p-4 bg-white border-t border-slate-200">
    <div class="input-container flex items-center">
        <textarea id="message-input" class="flex-grow p-3 bg-transparent text-slate-800 placeholder-slate-400 resize-none" rows="1" placeholder="اكتب رسالتك هنا..."></textarea>
        <button id="send-button" class="send-button">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M6 12L3.269 3.126A59.768 59.768 0 0121.485 12 59.77 59.77 0 013.27 20.876L5.999 12zm0 0h7.5" />
            </svg>
        </button>
    </div>
</footer>

</div>

<div id="custom-message-box" class="message-box">
    <p id="message-text"></p>
    <button onclick="document.getElementById('custom-message-box').style.display='none';" class="bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-2 px-4 rounded-full">حسنًا</button>
</div>

<div id="copy-toast">تم النسخ!</div>

<script>
function showMessage(text){
    const box=document.getElementById('custom-message-box');
    document.getElementById('message-text').innerText=text;
    box.style.display='block';
}

const chatWindow=document.getElementById('chat-window');
const messageInput=document.getElementById('message-input');
const sendButton=document.getElementById('send-button');
const newChatBtn=document.getElementById('newChatBtn');
const copyToast=document.getElementById('copy-toast');

function escapeHtml(text){ return text.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;"); }

function showCopyToast(){
    copyToast.style.display='block';
    setTimeout(()=>{copyToast.style.display='none';},1500);
}

function addMessageToChat(message, sender){
    const messageDiv = document.createElement('div');
    messageDiv.className = 'flex ' + (sender === 'user' ? 'justify-end' : 'justify-start');
    
    if(sender === 'user'){
        messageDiv.innerHTML = `<div class="user-message">${message}</div>`;
    } else {
        messageDiv.innerHTML = `<div class="ai-message">${message}</div>`;
    }

    chatWindow.appendChild(messageDiv);
    chatWindow.scrollTop = chatWindow.scrollHeight;
}

function addTypingIndicator(){
    const typingDiv=document.createElement('div');
    typingDiv.className='flex justify-start mb-4';
    typingDiv.innerHTML=`<div class="typing-indicator">
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
        <div class="typing-dot"></div>
    </div>`;
    chatWindow.appendChild(typingDiv);
    chatWindow.scrollTop=chatWindow.scrollHeight;
    return typingDiv;
}

function removeTypingIndicator(el){if(el) el.remove();}

async function sendMessage(){
    const userMessage = messageInput.value.trim();
    if(userMessage === '') return;
    
    addMessageToChat(userMessage, 'user');
    messageInput.value='';
    sendButton.disabled = true;
    
    const typing = addTypingIndicator();
    
    try {
        // استخدام API المقدم
        const apiUrl = `https://asta-hosting.x10.mx/text.php?4=${encodeURIComponent(userMessage)}`;
        const res = await fetch(apiUrl);
        const data = await res.json();
        
        // استخراج الرد فقط من البيانات
        const aiMessage = data.response;
        
        removeTypingIndicator(typing);
        addMessageToChat(aiMessage, 'ai');
    } catch(err) {
        removeTypingIndicator(typing);
        showMessage('حدث خطأ: ' + err.message);
        console.error(err);
    } finally {
        sendButton.disabled = false;
    }
}

sendButton.addEventListener('click', sendMessage);
messageInput.addEventListener('keydown', e => {
    if(e.key === 'Enter' && !e.shiftKey){
        e.preventDefault();
        sendMessage();
    }
});

newChatBtn.addEventListener('click', () => {
    chatWindow.innerHTML='';
    addMessageToChat('مرحباً! كيف يمكنني مساعدتك اليوم؟','ai');
});

// ضبط ارتفاع حقل الإدخال تلقائياً
messageInput.addEventListener('input', function() {
    this.style.height = 'auto';
    this.style.height = (this.scrollHeight) + 'px';
});

// رسالة ترحيب أولية
window.onload = function() {
    addMessageToChat('كيف يمكنني المساعدة؟','ai');
    
    // تأثيرات الخلفية المتحركة
    const canvas=document.getElementById('background-canvas');
    const ctx=canvas.getContext('2d');
    let particles=[];
    const particleCount=50;
    const linkDistance=150;

    function resizeCanvas(){canvas.width=window.innerWidth; canvas.height=window.innerHeight;}
    
    class Particle{
        constructor(x,y){
            this.x=x||Math.random()*canvas.width; 
            this.y=y||Math.random()*canvas.height; 
            this.vx=(Math.random()-0.5)*0.3; 
            this.vy=(Math.random()-0.5)*0.3; 
            this.radius=0.8; 
            this.color=`rgba(203, 213, 225, 0.5)`;
        }
        
        update(){
            this.x+=this.vx; 
            this.y+=this.vy; 
            if(this.x<0||this.x>canvas.width) this.vx*=-1; 
            if(this.y<0||this.y>canvas.height) this.vy*=-1;
        }
        
        draw(){
            ctx.fillStyle=this.color; 
            ctx.beginPath(); 
            ctx.arc(this.x,this.y,this.radius,0,Math.PI*2); 
            ctx.fill();
        }
    }
    
    function initParticles(){
        particles=[]; 
        for(let i=0;i<particleCount;i++) particles.push(new Particle());
    }
    
    function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.globalAlpha=0.3;
        
        particles.forEach(p=>p.update());
        
        for(let i=0;i<particles.length;i++){
            for(let j=i;j<particles.length;j++){
                const p1=particles[i], p2=particles[j];
                const dx=p1.x-p2.x, dy=p1.y-p2.y;
                const distance=Math.sqrt(dx*dx+dy*dy);
                
                if(distance<linkDistance){
                    ctx.strokeStyle=`rgba(148, 163, 184, ${1-distance/linkDistance})`;
                    ctx.lineWidth=0.3;
                    ctx.beginPath(); 
                    ctx.moveTo(p1.x,p1.y); 
                    ctx.lineTo(p2.x,p2.y); 
                    ctx.stroke();
                }
            }
        }
        
        particles.forEach(p=>p.draw());
        requestAnimationFrame(animate);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas(); 
    initParticles(); 
    animate();
};
</script>

</body>
</html>
